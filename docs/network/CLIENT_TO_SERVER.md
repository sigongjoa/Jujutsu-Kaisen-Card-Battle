# Client-to-Server Command Specification

**Strict Rule**: Clients do not "update state". Clients send **Intents**.

## 1. Command Structure

Every command MUST include an `actionId` for idempotency.

```typescript
interface ClientCommand {
  actionId: string; // UUID generated by client
  type: CommandType;
  payload: unknown;
}
```

## 2. Gameplay Commands (The Stack System)

Since this is a TCG, actions are not immediate. They enter a **Stack**.

### `DECLARE_ACTION`
Used for playing cards, activating abilities, or attacking.

```json
{
  "type": "DECLARE_ACTION",
  "payload": {
    "sourceId": "card_instance_uuid",
    "actionType": "PLAY_CARD", // or "ACTIVATE_ABILITY", "ATTACK"
    "targets": ["target_uuid_1"],
    "paymentParams": { "kicked": true } // Optional costs (e.g. Kicker)
  }
}
```
*Server Response*: `ACTION_ACCEPTED` (Action goes to Stack) or `ACTION_REJECTED`.

### `PASS_PRIORITY`
The core of the interaction engine. Signals that the player has no further actions for the current priority window.

```json
{
  "type": "PASS_PRIORITY",
  "payload": {}
}
```
*Logic*: If both players pass priority in succession, the top item of the Stack resolves. If Stack is empty, the Phase advances.

## 3. Game Control

### `MULLIGAN_DECISION`
```json
{
  "type": "MULLIGAN_DECISION",
  "payload": {
    "keptCardIndices": [0, 2, 3] // Indices of cards to keep
  }
}
```

### `SURRENDER`
```json
{
  "type": "SURRENDER",
  "payload": {}
}
```

## 4. Synchronization

### `SYNC_REQUEST`
Sent after reconnection to request missed data.

```json
{
  "type": "SYNC_REQUEST",
  "payload": {
    "lastSequenceId": 1042 // The last event ID the client successfully processed
  }
}
```

## 5. Anti-Cheat & Validation
- **Rate Limiting**: Commands exceeding 10/sec will trigger a warning. 20/sec = Auto-ban.
- **State Validation**: Sending a command for a card you don't own or isn't in your hand results in an immediate `INVALID_STATE` error and audit log entry.
