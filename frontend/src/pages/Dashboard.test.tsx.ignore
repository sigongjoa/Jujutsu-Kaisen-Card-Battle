import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import '@testing-library/jest-dom';
import { Provider } from 'react-redux';
import { BrowserRouter } from 'react-router-dom';
import { configureStore } from '@reduxjs/toolkit';
import authReducer from '../store/authSlice';
import { Dashboard } from './Dashboard';

// Mock Store
const createMockStore = () => configureStore({
    reducer: {
        auth: authReducer
    }
});

const renderWithProviders = (component: React.ReactElement) => {
    const store = createMockStore();
    return render(
        <Provider store={store}>
            <BrowserRouter>
                {component}
            </BrowserRouter>
        </Provider>
    );
};

describe('Dashboard Page Unit Tests', () => {
    test('Renders Dashboard Page with all elements', () => {
        const { container } = renderWithProviders(<Dashboard />);

        // Check Background
        expect(container.querySelector('.dashboard-background')).toBeInTheDocument();

        // Check Logo
        expect(screen.getByAltText('Jujutsu Kaisen Logo')).toBeInTheDocument();

        // Check Menu Container
        expect(container.querySelector('.dashboard-menu-container')).toBeInTheDocument();

        // Check Buttons
        expect(screen.getByText('LOBBY')).toBeInTheDocument();
        expect(screen.getByText('DECKS')).toBeInTheDocument();
        expect(screen.getByText('SHOP')).toBeInTheDocument();
        expect(screen.getByText('PROFILE')).toBeInTheDocument();
        expect(screen.getByText('SETTINGS')).toBeInTheDocument();
        expect(screen.getByText('LOGOUT')).toBeInTheDocument();
    });

    test('Logout button triggers navigation', () => {
        renderWithProviders(<Dashboard />);

        const logoutBtn = screen.getByText('LOGOUT');
        fireEvent.click(logoutBtn);

        // Since we are using BrowserRouter, we can't easily check location.pathname here without a custom history.
        // But we can verify the click doesn't crash.
    });
});
